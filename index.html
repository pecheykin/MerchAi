<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MerchAi — загрузка данных</title>
  <style>
    :root{--bg:#0b0f19;--card:#0f1425;--line:rgba(255,255,255,.08);--text:#e7eefc;--muted:#9bb0d1;--accent:#4fd1ff;--radius:16px;--shadow:0 12px 40px rgba(0,0,0,.35)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 20% 10%,#0f1730 0%,var(--bg) 50%),radial-gradient(1000px 800px at 80% 20%,#111b33 0%,var(--bg) 55%),var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Inter,Roboto,Arial,"Helvetica Neue",sans-serif}
    .wrap{max-width:1050px;margin:0 auto;padding:20px 16px 28px;display:grid;gap:18px}
    header{display:flex;align-items:center;gap:12px;padding:12px 14px;border:1px solid var(--line);border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));box-shadow:var(--shadow)}
    .logo{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg,#1e90ff,#00d4ff);color:#001221;font-weight:800}
    .brand{font-weight:800;font-size:22px;letter-spacing:.3px}

    .grid{display:grid;gap:18px}
    .card{border:1px solid var(--line);border-radius:var(--radius);background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));box-shadow:var(--shadow);padding:16px}
    .card h2{margin:0 0 6px;font-size:20px}
    .muted{color:var(--muted)}

    .zone{border:1px dashed var(--line);border-radius:14px;padding:16px;min-height:140px;display:grid;place-items:center;text-align:center;background:rgba(255,255,255,.02)}
    .zone.drag{outline:2px dashed var(--accent);outline-offset:4px}

    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{background:#13203a;border:1px solid var(--line);color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn.secondary{background:#1a273f}
    .counter{margin-left:auto;color:var(--muted);font-weight:600}

    /* thumbs */
    .thumbs{display:grid;grid-template-columns:repeat(auto-fill,minmax(96px,1fr));gap:10px;margin-top:12px}
    .thumb{position:relative;border-radius:12px;overflow:hidden;border:1px solid var(--line);background:#0e1323}
    .thumb img{width:100%;height:96px;object-fit:cover;display:block;cursor:pointer}
    .thumb .remove{position:absolute;top:6px;right:6px;width:24px;height:24px;border:none;border-radius:999px;background:rgba(0,0,0,.55);color:#fff;font-weight:800;line-height:24px;text-align:center;cursor:pointer}
    .thumb .cap{position:absolute;left:6px;bottom:6px;right:6px;background:linear-gradient(180deg,transparent,rgba(0,0,0,.65));color:#fff;font-size:11px;padding:18px 6px 6px;border-radius:8px}

    /* modal preview */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;padding:24px;z-index:50}
    .modal.open{display:flex}
    .modal__box{position:relative;max-width:min(92vw,900px);max-height:86vh}
    .modal__img{max-width:100%;max-height:86vh;border-radius:12px;border:1px solid var(--line);box-shadow:var(--shadow)}
    .modal__close{position:absolute;top:-12px;right:-12px;width:36px;height:36px;border:none;border-radius:999px;background:#0f1425;color:#fff;font-size:22px;cursor:pointer;box-shadow:var(--shadow)}

    input[type="text"], .input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#10162a;color:var(--text)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">M</div>
      <div class="brand">MerchAi</div>
    </header>

    <section class="grid">
      <!-- Обучение -->
      <div class="card" id="train-card">
        <h2>Обучение модели</h2>
        <p class="muted">Добавьте изображения товара (от 1 до 10 шт.). Файлы не отправляются на сервер — только предпросмотр в браузере.</p>
        <div class="zone" id="train-drop">
          <div class="row">
            <label class="btn" for="train-input">Выбрать файлы</label>
            <input id="train-input" type="file" accept="image/*" multiple hidden />
            <button class="btn secondary" id="train-clear">Очистить</button>
            <span class="counter" id="train-count">0/10</span>
          </div>
          <small class="muted">или перетащите сюда</small>
        </div>
        <div class="thumbs" id="train-thumbs"></div>
      </div>

      <!-- Поиск -->
      <div class="card" id="search-card">
        <h2>Поиск по фотографии</h2>
        <p class="muted">Введите наименование и добавьте 1 фото. Файлы остаются в браузере.</p>
        <div class="row" style="margin-bottom:8px">
          <input id="search-name" type="text" class="input" placeholder="Например: Coca‑Cola 0.5" />
        </div>
        <div class="zone" id="search-drop">
          <div class="row">
            <label class="btn" for="search-input">Выбрать фото</label>
            <input id="search-input" type="file" accept="image/*" hidden />
            <button class="btn secondary" id="search-clear">Удалить фото</button>
            <span class="counter" id="search-count">Фото: 0/1</span>
          </div>
          <small class="muted">или перетащите сюда</small>
        </div>
        <div class="thumbs" id="search-thumbs"></div>
      </div>
    </section>
  </div>

  <!-- Modal preview -->
  <div class="modal" id="previewModal" aria-hidden="true">
    <div class="modal__box">
      <img id="previewImg" class="modal__img" alt="preview" />
      <button class="modal__close" id="previewClose" aria-label="Закрыть">×</button>
    </div>
  </div>

  <script>
  // ===============================
  // Helpers
  // ===============================
  const $ = (s, p=document) => p.querySelector(s);
  const $$ = (s, p=document) => Array.from(p.querySelectorAll(s));

  function makeThumb(file, onRemove, caption){
    const url = URL.createObjectURL(file);
    const el = document.createElement('div');
    el.className = 'thumb';

    const img = document.createElement('img');
    img.src = url; img.alt = file.name;
    img.addEventListener('click', () => openPreview(url));

    const rm = document.createElement('button');
    rm.className = 'remove'; rm.textContent = '×';
    rm.title = 'Удалить';
    rm.addEventListener('click', (e)=>{ e.stopPropagation(); URL.revokeObjectURL(url); onRemove?.();});

    if(caption){
      const cap = document.createElement('div');
      cap.className = 'cap'; cap.textContent = caption;
      el.append(img, rm, cap);
    } else {
      el.append(img, rm);
    }
    return el;
  }

  // ===============================
  // PREVIEW MODAL
  // ===============================
  const modal = $('#previewModal');
  const modalImg = $('#previewImg');
  const modalClose = $('#previewClose');
  function openPreview(src){ modalImg.src = src; modal.classList.add('open'); }
  function closePreview(){ modal.classList.remove('open'); modalImg.removeAttribute('src'); }
  modalClose.addEventListener('click', closePreview);
  modal.addEventListener('click', (e)=>{ if(e.target===modal) closePreview(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePreview(); });

  // ===============================
  // TRAINING BLOCK (up to 10 files)
  // ===============================
  const trainState = { files: [] };
  const trainInput = $('#train-input');
  const trainDrop = $('#train-drop');
  const trainThumbs = $('#train-thumbs');
  const trainCount = $('#train-count');
  const trainClear = $('#train-clear');

  function renderTrain(){
    trainThumbs.innerHTML='';
    trainState.files.forEach((f, i)=>{
      const el = makeThumb(f, ()=>{ trainState.files.splice(i,1); renderTrain(); }, (i+1)+'. '+(f._name||f.name));
      trainThumbs.appendChild(el);
    });
    trainCount.textContent = `${trainState.files.length}/10`;
  }

  function addTrainFiles(list){
    const arr = Array.from(list).slice(0, 10 - trainState.files.length);
    arr.forEach((f)=>{ trainState.files.push(f); });
    renderTrain();
  }

  trainInput.addEventListener('change', (e)=> addTrainFiles(e.target.files));
  trainClear.addEventListener('click', ()=>{ trainState.files = []; renderTrain(); trainInput.value='';});

  // drag & drop
  ;['dragenter','dragover'].forEach(ev=> trainDrop.addEventListener(ev, e=>{ e.preventDefault(); trainDrop.classList.add('drag'); }));
  ;['dragleave','drop'].forEach(ev=> trainDrop.addEventListener(ev, e=>{ e.preventDefault(); trainDrop.classList.remove('drag'); }));
  trainDrop.addEventListener('drop', e=> addTrainFiles(e.dataTransfer.files));

  // ===============================
  // SEARCH BLOCK (single file + name)
  // ===============================
  const searchState = { file: null };
  const searchInput = $('#search-input');
  const searchDrop = $('#search-drop');
  const searchThumbs = $('#search-thumbs');
  const searchCount = $('#search-count');
  const searchClear = $('#search-clear');
  const searchName = $('#search-name');

  function renderSearch(){
    searchThumbs.innerHTML='';
    if(searchState.file){
      const caption = (searchName.value || '').trim();
      const el = makeThumb(searchState.file, ()=>{ searchState.file=null; renderSearch(); searchInput.value=''; }, caption);
      searchThumbs.appendChild(el);
      searchCount.textContent = 'Фото: 1/1';
    } else {
      searchCount.textContent = 'Фото: 0/1';
    }
  }

  function setSearchFile(file){ searchState.file = file || null; renderSearch(); }
  searchInput.addEventListener('change', (e)=> setSearchFile(e.target.files[0]));
  searchClear.addEventListener('click', ()=>{ setSearchFile(null); searchInput.value='';});
  searchName.addEventListener('input', renderSearch);

  ;['dragenter','dragover'].forEach(ev=> searchDrop.addEventListener(ev, e=>{ e.preventDefault(); searchDrop.classList.add('drag'); }));
  ;['dragleave','drop'].forEach(ev=> searchDrop.addEventListener(ev, e=>{ e.preventDefault(); searchDrop.classList.remove('drag'); }));
  searchDrop.addEventListener('drop', e=> setSearchFile(e.dataTransfer.files[0]));

  // first render
  renderTrain();
  renderSearch();
  </script>
</body>
</html>
